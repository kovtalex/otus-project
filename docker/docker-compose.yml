version: '3.7'
services:
  mongo:
    image: mongo:${MONGO_VER}
    restart: on-failure
    volumes:
      - mongo_db:/data/db
    networks:
      back_net:

  rabbitmq:
    image: ${REGISTRY_USERNAME}/rabbitmq:${RABBITMQ_VER}
    restart: on-failure
    ports:
      - 15672:15672
    volumes:
      - rabbit_mq_data:/var/lib/rabbitmq:rw      
    networks:
      back_net:
 
  ui:
    image: ${REGISTRY_USERNAME}/search_engine_ui:${UI_VER}
    restart: on-failure
    environment:
      - MONGO=mongo
      - MONGO_PORT=27017
    ports:
      - 80:8000
    depends_on:
      - mongo
    networks:
      back_net:

  crawler:
    image: ${REGISTRY_USERNAME}/search_engine_crawler:${CRAWLER_VER}
    restart: on-failure
    environment:
      - MONGO=mongo
      - MONGO_PORT=27017
      - RMQ_HOST=rabbitmq
      - RMQ_QUEUE=urls
      - RMQ_USERNAME=guest
      - RMQ_PASSWORD=guest
      - CHECK_INTERVAL=60
      - URL=https://vitkhab.github.io/search_engine_test_site/
      - EXCLUDE_URLS=.*github.com
    depends_on:
      - mongo
      - rabbitmq
    networks:
      back_net:

volumes:
  mongo_db:
  rabbit_mq_data:

networks:
  back_net:
